<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator App</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .nav-tabs {
            background-color: #343a40;
        }
        .nav-tabs .nav-link {
            color: #f8f9fa;
            border: 1px solid #f8f9fa;
            margin-right: 5px;
        }
        .nav-tabs .nav-link.active {
            background-color: #dc3545;
            color: #f8f9fa;
            border: 1px solid #f8f9fa;
        }
        .btn-custom {
            background-color: #dc3545;
            color: #f8f9fa;
        }
        .btn-custom:hover {
            background-color: #c82333;
        }
        .result, .real-math {
            margin-top: 20px;
        }
        .fixed-width-select {
            width: 100%;
        }
        @media (min-width: 768px) {
            .fixed-width-select {
                width: 400px;
            }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4">Calculator App</h2>
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" href="#calculator" data-toggle="tab">Calculator</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#add" data-toggle="tab">Add</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#edit" data-toggle="tab">Edit/Delete</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#history" data-toggle="tab">History</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="calculator">
                <form id="calculatorForm" onsubmit="calculate(); return false;">
                    <div class="form-group">
                        <label for="itemName">Item Name</label>
                        <select class="form-control fixed-width-select" id="itemName" onchange="updateSqFtValues()">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="requested">Requested</label>
                        <input type="number" class="form-control" id="requested" placeholder="Enter requested quantity" onkeypress="if(event.keyCode == 13) calculate()">
                    </div>
                    <div class="form-group">
                        <label for="sqftPerBox">SqFt per Box</label>
                        <input type="number" class="form-control" id="sqftPerBox" placeholder="Enter SqFt per box" readonly>
                    </div>
                    <div class="form-group">
                        <label for="sqftPerPiece">SqFt per Piece</label>
                        <input type="number" class="form-control" id="sqftPerPiece" placeholder="Enter SqFt per piece" readonly>
                    </div>
                    <button type="button" class="btn btn-custom btn-block" onclick="calculate()">Calculate</button>
                </form>
                <div class="result alert alert-info mt-3 fade-in" id="result" style="display: none;"></div>
                <div class="real-math alert alert-secondary mt-3 fade-in" id="realMath" style="display: none;"></div>
            </div>
            <div class="tab-pane fade" id="add">
                <form onsubmit="addItem(event)">
                    <div class="form-group">
                        <label for="newItemName">Item Name</label>
                        <input type="text" class="form-control" id="newItemName" required>
                    </div>
                    <div class="form-group">
                        <label for="newSqFtPerBox">SqFt per Box</label>
                        <input type="number" class="form-control" id="newSqFtPerBox" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="newSqFtPerPiece">SqFt per Piece</label>
                        <input type="number" class="form-control" id="newSqFtPerPiece" step="0.01" required>
                    </div>
                    <button type="submit" class="btn btn-custom btn-block">Add Item</button>
                </form>
            </div>
            <div class="tab-pane fade" id="edit">
                <div class="form-group">
                    <label for="editItemName">Select Item</label>
                    <select class="form-control fixed-width-select" id="editItemName" onchange="populateEditForm()">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <form onsubmit="editItem(event)">
                    <div class="form-group">
                        <label for="editSqFtPerBox">SqFt per Box</label>
                        <input type="number" class="form-control" id="editSqFtPerBox" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="editSqFtPerPiece">SqFt per Piece</label>
                        <input type="number" class="form-control" id="editSqFtPerPiece" step="0.01" required>
                    </div>
                    <button type="submit" class="btn btn-custom btn-block">Edit Item</button>
                </form>
                <button class="btn btn-danger btn-block mt-2" onclick="deleteItem()">Delete Item</button>
            </div>
            <div class="tab-pane fade" id="history">
                <h4 class="mt-3">Calculation History</h4>
                <ul class="list-group" id="historyList">
                    <!-- History items will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, get, set, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCZBYPUvrmzPiAtm7RiQ9304s284Fx9Xnw",
            authDomain: "cut-calculator-aeb02.firebaseapp.com",
            databaseURL: "https://cut-calculator-aeb02-default-rtdb.firebaseio.com",
            projectId: "cut-calculator-aeb02",
            storageBucket: "cut-calculator-aeb02.appspot.com",
            messagingSenderId: "637507936787",
            appId: "1:637507936787:web:7aa7995e6e4827e66a55e6",
            measurementId: "G-2FGQE4TWRL"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let items = [];
        let history = [];

        function fetchItems() {
            const dbRef = ref(db);
            get(child(dbRef, 'items')).then((snapshot) => {
                if (snapshot.exists()) {
                    items = snapshot.val() || [];
                    populateDropdowns();
                }
            }).catch(error => {
                console.error("Error fetching items: ", error);
            });
        }

        function populateDropdowns() {
            const itemNameSelect = $('#itemName');
            const editItemNameSelect = $('#editItemName');
            itemNameSelect.empty();
            editItemNameSelect.empty();
            items.forEach(item => {
                const option = `<option value="${item.name}">${item.name}</option>`;
                itemNameSelect.append(option);
                editItemNameSelect.append(option);
            });
            itemNameSelect.select2();
            editItemNameSelect.select2();
        }

        function updateSqFtValues() {
            const selectedItemName = document.getElementById('itemName').value;
            const selectedItem = items.find(item => item.name === selectedItemName);

            if (selectedItem) {
                document.getElementById('sqftPerBox').value = selectedItem.sqftPerBox;
                document.getElementById('sqftPerPiece').value = selectedItem.sqftPerPiece;
            }
        }

        function calculate() {
            const requested = parseFloat(document.getElementById('requested').value);
            const sqftPerBox = parseFloat(document.getElementById('sqftPerBox').value);
            const sqftPerPiece = parseFloat(document.getElementById('sqftPerPiece').value);

            if (isNaN(requested) || isNaN(sqftPerBox) || isNaN(sqftPerPiece)) {
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').className = 'result alert alert-danger fade-in';
                document.getElementById('result').innerText = 'Please enter valid numbers';
                document.getElementById('realMath').style.display = 'none';
                return;
            }

            const maxBoxes = Math.floor(requested / sqftPerBox);
            let boxes = 0;
            let pieces = 0;
            let actualSqFt = 0;

            for (let b = maxBoxes; b >= 0; b--) {
                const remainingSqFt = requested - (b * sqftPerBox);
                const p = Math.floor(remainingSqFt / sqftPerPiece);
                const totalSqFt = (b * sqftPerBox) + (p * sqftPerPiece);

                if (totalSqFt <= requested) {
                    boxes = b;
                    pieces = p;
                    actualSqFt = totalSqFt;
                    break;
                }
            }

            document.getElementById('result').style.display = 'block';
            document.getElementById('result').className = 'result alert alert-info fade-in';
            document.getElementById('result').innerText = `Boxes: ${boxes}, Pieces: ${pieces}`;
            document.getElementById('realMath').style.display = 'block';
            document.getElementById('realMath').className = 'real-math alert alert-secondary fade-in';
            document.getElementById('realMath').innerText = `Actual Square Footage: ${actualSqFt.toFixed(2)}`;

            addToHistory({
                type: 'Calculation',
                itemName: document.getElementById('itemName').value,
                requested: requested,
                boxes: boxes,
                pieces: pieces,
                actualSqFt: actualSqFt.toFixed(2)
            });
        }

        function addToHistory(entry) {
            history.unshift(entry);
            if (history.length > 10) {
                history.pop();
            }
            updateHistory();
        }

        function updateHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            history.forEach(entry => {
                const li = document.createElement('li');
                li.className = 'list-group-item fade-in';
                li.innerText = entry.type === 'Calculation' ? 
                    `Calculation - Item: ${entry.itemName}, Requested: ${entry.requested}, Boxes: ${entry.boxes}, Pieces: ${entry.pieces}, Actual SqFt: ${entry.actualSqFt}` :
                    `${entry.type} - Item: ${entry.itemName}, SqFt per Box: ${entry.sqftPerBox}, SqFt per Piece: ${entry.sqftPerPiece}`;
                historyList.appendChild(li);
            });
        }

        function addItem(event) {
            event.preventDefault();
            const newItemName = document.getElementById('newItemName').value;
            const newSqFtPerBox = parseFloat(document.getElementById('newSqFtPerBox').value);
            const newSqFtPerPiece = parseFloat(document.getElementById('newSqFtPerPiece').value);

            if (!newItemName || isNaN(newSqFtPerBox) || isNaN(newSqFtPerPiece)) {
                alert('Please enter valid details.');
                return;
            }

            const newItem = {
                name: newItemName,
                sqftPerBox: newSqFtPerBox,
                sqftPerPiece: newSqFtPerPiece
            };

            items.push(newItem);
            set(ref(db, 'items'), items)
                .then(() => {
                    addToHistory({
                        type: 'Add',
                        itemName: newItemName,
                        sqftPerBox: newSqFtPerBox,
                        sqftPerPiece: newSqFtPerPiece
                    });
                    populateDropdowns();
                    alert('Item added successfully!');
                    document.getElementById('newItemName').value = '';
                    document.getElementById('newSqFtPerBox').value = '';
                    document.getElementById('newSqFtPerPiece').value = '';
                })
                .catch(error => {
                    console.error("Error adding item: ", error);
                    alert("Error adding item: " + error.message);
                });
        }

        function populateEditForm() {
            const selectedItemName = document.getElementById('editItemName').value;
            const selectedItem = items.find(item => item.name === selectedItemName);

            if (selectedItem) {
                document.getElementById('editSqFtPerBox').value = selectedItem.sqftPerBox;
                document.getElementById('editSqFtPerPiece').value = selectedItem.sqftPerPiece;
            }
        }

        function editItem(event) {
            event.preventDefault();
            const selectedItemName = document.getElementById('editItemName').value;
            const editSqFtPerBox = parseFloat(document.getElementById('editSqFtPerBox').value);
            const editSqFtPerPiece = parseFloat(document.getElementById('editSqFtPerPiece').value);

            if (!selectedItemName || isNaN(editSqFtPerBox) || isNaN(editSqFtPerPiece)) {
                alert('Please enter valid details.');
                return;
            }

            const selectedItem = items.find(item => item.name === selectedItemName);
            if (selectedItem) {
                selectedItem.sqftPerBox = editSqFtPerBox;
                selectedItem.sqftPerPiece = editSqFtPerPiece;
                set(ref(db, 'items'), items)
                    .then(() => {
                        addToHistory({
                            type: 'Edit',
                            itemName: selectedItemName,
                            sqftPerBox: editSqFtPerBox,
                            sqftPerPiece: editSqFtPerPiece
                        });
                        populateDropdowns();
                        alert('Item edited successfully!');
                    })
                    .catch(error => {
                        console.error("Error editing item: ", error);
                        alert("Error editing item: " + error.message);
                    });
            }
        }

        function deleteItem() {
            const selectedItemName = document.getElementById('editItemName').value;
            const selectedItem = items.find(item => item.name === selectedItemName);

            if (selectedItem) {
                addToHistory({
                    type: 'Delete',
                    itemName: selectedItemName,
                    sqftPerBox: selectedItem.sqftPerBox,
                    sqftPerPiece: selectedItem.sqftPerPiece
                });

                items = items.filter(item => item.name !== selectedItemName);
                set(ref(db, 'items'), items)
                    .then(() => {
                        populateDropdowns();
                        alert('Item deleted successfully!');
                    })
                    .catch(error => {
                        console.error("Error deleting item: ", error);
                        alert("Error deleting item: " + error.message);
                    });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchItems();
        });
    </script>
</body>
</html>
